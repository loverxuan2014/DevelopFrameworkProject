"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const utils_1 = require("../utils/utils");
const console_1 = require("../../lib/modules/console");
const constants_1 = require("../utils/constants");
function default_1(program) {
    program.command('restart')
        .description('restart the servers, for multiple servers, use `pinus restart server-id-1 server-id-2`')
        .option('-u, --username <username>', 'administration user name', constants_1.DEFAULT_USERNAME)
        .option('-p, --password <password>', 'administration password', constants_1.DEFAULT_PWD)
        .option('-h, --host <master-host>', 'master server host', constants_1.DEFAULT_MASTER_HOST)
        .option('-P, --port <master-port>', 'master server port', (value) => parseInt(value), constants_1.DEFAULT_MASTER_PORT)
        .option('-t, --type <server-type>,', 'start server type')
        .option('-i, --id <server-id>', 'start server id')
        .action(function (opts) {
        restart(opts);
    });
}
exports.default = default_1;
function restart(opts) {
    let id = 'pinus_restart_' + Date.now();
    let serverIds = [];
    let type = null;
    if (!!opts.id) {
        serverIds.push(opts.id);
    }
    if (!!opts.type) {
        type = opts.type;
    }
    (0, utils_1.connectToMaster)(id, opts, function (client) {
        client.request(console_1.ConsoleModule.moduleId, { signal: 'restart', ids: serverIds, type: type }, function (err, fails) {
            if (!!err) {
                console.error(err);
            }
            else if (!!fails.length) {
                console.info('restart fails server ids: %j', fails);
            }
            else {
                console.info(constants_1.RESTART_SERVER_INFO);
            }
            process.exit(0);
        });
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdGFydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2Jpbi9jb21tYW5kcy9yZXN0YXJ0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBS0EsMENBQWlEO0FBQ2pELHVEQUFnRTtBQUNoRSxrREFBbUo7QUFHbkosbUJBQXlCLE9BQWdCO0lBQ3JDLE9BQU8sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO1NBQ3pCLFdBQVcsQ0FBQyx3RkFBd0YsQ0FBQztTQUNyRyxNQUFNLENBQUMsMkJBQTJCLEVBQUUsMEJBQTBCLEVBQUUsNEJBQWdCLENBQUM7U0FDakYsTUFBTSxDQUFDLDJCQUEyQixFQUFFLHlCQUF5QixFQUFFLHVCQUFXLENBQUM7U0FDM0UsTUFBTSxDQUFDLDBCQUEwQixFQUFFLG9CQUFvQixFQUFFLCtCQUFtQixDQUFDO1NBQzdFLE1BQU0sQ0FBQywwQkFBMEIsRUFBRSxvQkFBb0IsRUFBRSxDQUFDLEtBQUssRUFBQyxFQUFFLENBQUEsUUFBUSxDQUFDLEtBQUssQ0FBQyxFQUFFLCtCQUFtQixDQUFDO1NBQ3ZHLE1BQU0sQ0FBQywyQkFBMkIsRUFBRSxtQkFBbUIsQ0FBQztTQUN4RCxNQUFNLENBQUMsc0JBQXNCLEVBQUUsaUJBQWlCLENBQUM7U0FDakQsTUFBTSxDQUFDLFVBQVUsSUFBSTtRQUNsQixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbEIsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBWkQsNEJBWUM7QUFHRCxTQUFTLE9BQU8sQ0FBQyxJQUFTO0lBQ3RCLElBQUksRUFBRSxHQUFHLGdCQUFnQixHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUN2QyxJQUFJLFNBQVMsR0FBYSxFQUFFLENBQUM7SUFDN0IsSUFBSSxJQUFJLEdBQVcsSUFBSSxDQUFDO0lBQ3hCLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDWCxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztLQUMzQjtJQUNELElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUU7UUFDYixJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztLQUNwQjtJQUNELElBQUEsdUJBQWUsRUFBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsTUFBTTtRQUN0QyxNQUFNLENBQUMsT0FBTyxDQUFDLHVCQUFFLENBQUMsUUFBUSxFQUFFLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxVQUFVLEdBQVUsRUFBRSxLQUFlO1lBQ2hILElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRTtnQkFDUCxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3RCO2lCQUFNLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUU7Z0JBQ3ZCLE9BQU8sQ0FBQyxJQUFJLENBQUMsOEJBQThCLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDdkQ7aUJBQU07Z0JBQ0gsT0FBTyxDQUFDLElBQUksQ0FBQywrQkFBbUIsQ0FBQyxDQUFDO2FBQ3JDO1lBQ0QsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyJ9