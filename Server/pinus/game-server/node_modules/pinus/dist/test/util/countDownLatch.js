"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
let CountDownLatch = require('../../lib/util/countDownLatch');
require("should");
// import { describe, it } from "mocha-typescript"
let cbCreator = (function () {
    let count = 0;
    return {
        callback: function () {
            count++;
        },
        getCount: function () {
            return count;
        },
        count: count
    };
})();
describe('countdown latch test', function () {
    let countDownLatch1;
    let countDownLatch2;
    describe('#count down', function () {
        it('should invoke the callback after the done method was invoked the specified times', function (done) {
            let n = 3, doneCount = 0;
            let cdl = CountDownLatch.createCountDownLatch(n, function () {
                doneCount.should.equal(n);
                done();
            });
            for (let i = 0; i < n; i++) {
                doneCount++;
                cdl.done();
            }
        });
        it('should throw exception if pass a negative or zero to the create method', function () {
            (function () {
                CountDownLatch.createCountDownLatch(-1, function () {
                });
            }).should.throw();
            (function () {
                CountDownLatch.createCountDownLatch(0, function () {
                });
            }).should.throw();
        });
        it('should throw exception if pass illegal cb to the create method', function () {
            (function () {
                CountDownLatch.createCountDownLatch(1, null);
            }).should.throw();
        });
        it('should throw exception if try to invoke done metho of a latch that has fired cb', function () {
            let n = 3;
            let cdl = CountDownLatch.createCountDownLatch(n, function () {
            });
            for (let i = 0; i < n; i++) {
                cdl.done();
            }
            (function () {
                cdl.done();
            }).should.throw();
        });
        it('should invoke the callback if timeout', function () {
            let n = 3;
            let cdl = CountDownLatch.createCountDownLatch(n, { timeout: 3000 }, function (isTimeout) {
                isTimeout.should.equal(true);
            });
            for (let i = 0; i < n - 1; i++) {
                cdl.done();
            }
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY291bnREb3duTGF0Y2guanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi90ZXN0L3V0aWwvY291bnREb3duTGF0Y2gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLGNBQWMsR0FBRyxPQUFPLENBQUMsK0JBQStCLENBQUMsQ0FBQztBQUM5RCxrQkFBZ0I7QUFDaEIsa0RBQWtEO0FBRWxELElBQUksU0FBUyxHQUFHLENBQUM7SUFDYixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7SUFFZCxPQUFPO1FBQ0gsUUFBUSxFQUFFO1lBQ04sS0FBSyxFQUFFLENBQUM7UUFDWixDQUFDO1FBQ0QsUUFBUSxFQUFFO1lBQ04sT0FBTyxLQUFLLENBQUM7UUFDakIsQ0FBQztRQUNELEtBQUssRUFBRSxLQUFLO0tBQ2YsQ0FBQztBQUNOLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFFTCxRQUFRLENBQUMsc0JBQXNCLEVBQUU7SUFDN0IsSUFBSSxlQUFlLENBQUM7SUFDcEIsSUFBSSxlQUFlLENBQUM7SUFFcEIsUUFBUSxDQUFDLGFBQWEsRUFBRTtRQUNwQixFQUFFLENBQUMsa0ZBQWtGLEVBQUUsVUFBVSxJQUFnQjtZQUM3RyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsU0FBUyxHQUFHLENBQUMsQ0FBQztZQUN6QixJQUFJLEdBQUcsR0FBRyxjQUFjLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxFQUFFO2dCQUM3QyxTQUFTLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUIsSUFBSSxFQUFFLENBQUM7WUFDWCxDQUFDLENBQUMsQ0FBQztZQUVILEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ3hCLFNBQVMsRUFBRSxDQUFDO2dCQUNaLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQzthQUNkO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0VBQXdFLEVBQUU7WUFDekUsQ0FBQztnQkFDRyxjQUFjLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ3hDLENBQUMsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBRWxCLENBQUM7Z0JBQ0csY0FBYyxDQUFDLG9CQUFvQixDQUFDLENBQUMsRUFBRTtnQkFDdkMsQ0FBQyxDQUFDLENBQUM7WUFDUCxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDdEIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0VBQWdFLEVBQUU7WUFDakUsQ0FBQztnQkFDRyxjQUFjLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ2pELENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN0QixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpRkFBaUYsRUFBRTtZQUNsRixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDVixJQUFJLEdBQUcsR0FBRyxjQUFjLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxFQUFFO1lBQ2pELENBQUMsQ0FBQyxDQUFDO1lBRUgsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDeEIsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO2FBQ2Q7WUFFRCxDQUFDO2dCQUNHLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNmLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN0QixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRTtZQUN4QyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDVixJQUFJLEdBQUcsR0FBRyxjQUFjLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxFQUFFLFVBQVUsU0FBa0I7Z0JBQzVGLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pDLENBQUMsQ0FBQyxDQUFDO1lBRUgsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQzVCLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQzthQUNkO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIn0=